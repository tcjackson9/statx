<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Custom Theme Style -->
    <link href="./style.css" rel="stylesheet">
  </head>

  <body>
  <!-- page content -->
   <!-- Header Section -->
   <header>
    <div class="logo">
        <h1>Stats X</h1>
    </div>

    <!-- Navigation Bar -->
    <nav>
        <a href="index.html">Home</a>
        <a href="defense.html">Defense v.s. Position</a>
        <a href="playerStats.html">Player Stats</a>
        <a href="playerProjections.html">Player Projections</a>
    </nav>
    </header>

  <div class="Title" style="margin-top:100px;">
    <h1 style="color: #2A3F54;"><strong>COMPARE HERE</strong></h1> 
  </div>
  <div class="menu-row">
  <!-- Team Dropdown -->
  <div class="dropdown hover">
    <a href="#" id="teamSelectText">Select Team</a>
    <ul id="teamList">
      <li><a href="#" data-value="BLANK">TEAMS:</a></li>
      <li><a href="#" data-value="SF">49ers</a></li>
      <li><a href="#" data-value="CHI">Bears</a></li>
      <li><a href="#" data-value="CIN">Bengals</a></li>
      <li><a href="#" data-value="BUF">Bills</a></li>
      <li><a href="#" data-value="DEN">Broncos</a></li>
      <li><a href="#" data-value="CLE">Browns</a></li>
      <li><a href="#" data-value="TB">Buccaneers</a></li>
      <li><a href="#" data-value="ARI">Cardinals</a></li>
      <li><a href="#" data-value="LAC">Chargers</a></li>
      <li><a href="#" data-value="KC">Chiefs</a></li>
      <li><a href="#" data-value="IND">Colts</a></li>
      <li><a href="#" data-value="WAS">Commanders</a></li>
      <li><a href="#" data-value="DAL">Cowboys</a></li>
      <li><a href="#" data-value="MIA">Dolphins</a></li>
      <li><a href="#" data-value="PHI">Eagles</a></li>
      <li><a href="#" data-value="ATL">Falcons</a></li>
      <li><a href="#" data-value="NYG">Giants</a></li>
      <li><a href="#" data-value="JAC">Jaguars</a></li>
      <li><a href="#" data-value="NYJ">Jets</a></li>
      <li><a href="#" data-value="DET">Lions</a></li>
      <li><a href="#" data-value="GB">Packers</a></li>
      <li><a href="#" data-value="CAR">Panthers</a></li>
      <li><a href="#" data-value="NE">Patriots</a></li>
      <li><a href="#" data-value="LV">Raiders</a></li>
      <li><a href="#" data-value="LAR">Rams</a></li>
      <li><a href="#" data-value="BAL">Ravens</a></li>
      <li><a href="#" data-value="NO">Saints</a></li>
      <li><a href="#" data-value="SEA">Seahawks</a></li>
      <li><a href="#" data-value="PIT">Steelers</a></li>
      <li><a href="#" data-value="HOU">Texans</a></li>
      <li><a href="#" data-value="TEN">Titans</a></li>
      <li><a href="#" data-value="MIN">Vikings</a></li>
    </ul>
  </div>

  <span class="vs-text">V.S.</span>

  <!-- Position Dropdown -->
  <div class="dropdown hover">
    <a href="#" id="positionSelectText">Select Position</a>
    <ul id="positionList">
      <li><a href="#" data-value="BLANK">Positions:</a></li>
      <li><a href="#" data-value="RB">Running Back</a></li>
      <li><a href="#" data-value="WR">Wide Receiver</a></li>
      <li><a href="#" data-value="TE">Tight End</a></li>
      <li><a href="#" data-value="QB">Quarterback</a></li>
    </ul>
  </div>
</div>
        
        <div class="column-selection" style="margin-top: 20px;">
          <h4 style="color:black">Select Stats to Display</h4>
          <label><input type="checkbox" data-column="Week" checked> Week</label>
          <label><input type="checkbox" data-column="Matchup" checked> Matchup</label>
          <label><input type="checkbox" data-column="RushingAttempts" checked> Rushing Attempts</label>
          <label><input type="checkbox" data-column="TotalRushingYards" checked> Total Rushing Yards</label>
          <label><input type="checkbox" data-column="AvgYardsPerCarry" checked> Avg. Yards per Carry</label>
          <label><input type="checkbox" data-column="RushingTDs" checked> Rushing TDs</label>
          <label><input type="checkbox" data-column="Targets" checked> Targets</label>
          <label><input type="checkbox" data-column="Receptions" checked> Receptions</label>
          <label><input type="checkbox" data-column="TotalReceivingYards" checked> Total Receiving Yards</label>
          <label><input type="checkbox" data-column="AvgYardsPerCatch" checked> Avg. Yards per Catch</label>
          <label><input type="checkbox" data-column="ReceivingTDs" checked> Receiving TDs</label>
      </div>
      
        <!-- Compare Button -->
        <div class="compare-btn-container">
            <a href="#" id="compareButton" class="compare-btn">Compare</a>
        </div>

        <!-- Stat Table -->
          <div class="x_panel">
              <div class="x_title">
                  <h2>Team Stats <small>vs Position</small></h2>
                  <div class="clearfix"></div>
              </div>
              <div class="x_content">
                <div class="table-responsive">
                  <table class="table table-striped">
                      <thead>
                          <tr>
                              <th>Week</th>
                              <th>Matchup</th>
                              <th>Rushing Attempts</th>
                              <th>Total Rushing Yards</th>
                              <th>Avg. Yards per Carry</th>
                              <th>Rushing TDs</th>
                              <th>Targets</th>
                              <th>Receptions</th>
                              <th>Total Receiving Yards</th>
                              <th>Avg. Yards per Catch</th>
                              <th>Receiving TDs</th>
                          </tr>
                      </thead>
                      <tbody id="statsTableBody">
                          <!-- Rows will be inserted here by JavaScript -->
                      </tbody>
                  </table>
                </div>
              </div>
          </div>
      
        <!-- Output container to show results -->
        <div id="output"></div>
        
        <!-- Footer Section -->
        <footer>
            <p>&copy; 2024 Stats X. All rights reserved.</p>
        </footer>

        <script>
        let selectedTeam = '';
        let selectedPosition = '';

        // Define columns by position
        const columnsByPosition = {
            QB: [
                { name: 'Week', id: 'Week' },
                { name: 'Matchup', id: 'Matchup' },
                { name: 'Passing Attempts', id: 'PassingAttempts' },
                { name: 'Completions', id: 'Completions' },
                { name: 'Passing Yards', id: 'PassingYards' },
                { name: 'Passing Touchdowns', id: 'PassingTDs' },
                { name: 'Interceptions', id: 'Interceptions' },
                { name: 'Rate', id: 'Rate' },
                { name: 'Rush Attempts', id: 'RushAttempts' },
                { name: 'Rush Yards', id: 'RushYards' },
                { name: 'Avg Rush Yards', id: 'AvgRushYards' },
                { name: 'Rushing Touchdowns', id: 'RushingTDs' }
            ],
            default: [
                { name: 'Week', id: 'Week' },
                { name: 'Matchup', id: 'Matchup' },
                { name: 'Rushing Attempts', id: 'RushingAttempts' },
                { name: 'Total Rushing Yards', id: 'TotalRushingYards' },
                { name: 'Avg. Yards per Carry', id: 'AvgYardsPerCarry' },
                { name: 'Rushing TDs', id: 'RushingTDs' },
                { name: 'Targets', id: 'Targets' },
                { name: 'Receptions', id: 'Receptions' },
                { name: 'Total Receiving Yards', id: 'TotalReceivingYards' },
                { name: 'Avg. Yards per Catch', id: 'AvgYardsPerCatch' },
                { name: 'Receiving TDs', id: 'ReceivingTDs' }
            ]
        };

        // Function to update checkboxes dynamically
        function updateCheckboxes() {
            const columnSelection = document.querySelector('.column-selection');
            columnSelection.innerHTML = '<h4 style="color:black">Select Stats to Display</h4>';

            const columns = selectedPosition === 'QB' ? columnsByPosition.QB : columnsByPosition.default;

            columns.forEach(col => {
                const label = document.createElement('label');
                label.innerHTML = `<input type="checkbox" data-column="${col.id}" checked> ${col.name}`;
                columnSelection.appendChild(label);
            });
        }

        // Update table headers dynamically based on selected checkboxes
        function updateTableHeaders() {
            const tableHead = document.querySelector('.table thead tr');
            tableHead.innerHTML = '';

            const columns = selectedPosition === 'QB' ? columnsByPosition.QB : columnsByPosition.default;

            const selectedColumns = Array.from(
                document.querySelectorAll('.column-selection input:checked')
            ).map((checkbox) => {
                const columnId = checkbox.getAttribute('data-column');
                return columns.find((col) => col.id === columnId);
            });

            selectedColumns.forEach((col) => {
                if (col) {
                    const th = document.createElement('th');
                    th.textContent = col.name;
                    th.setAttribute('data-column', col.id);
                    tableHead.appendChild(th);
                }
            });

            return selectedColumns.map((col) => col.id);
        }

        // Update the table rows dynamically based on selected columns and data
        function updateTableRows(rows, selectedColumns) {
    const tableBody = document.getElementById('statsTableBody');
    tableBody.innerHTML = ''; // Clear existing rows

    rows.forEach((row, rowIndex) => {
        const newRow = document.createElement('tr');

        // Populate the row with selected columns
        selectedColumns.forEach((colId) => {
            const td = document.createElement('td');
            td.textContent = row[colId] || '';
            newRow.appendChild(td);
        });

        const matchupCellContent = row['Matchup'] || '';
        const isExpandableRow = matchupCellContent.includes('[+]');
        const isHiddenRow = !row['Week'];

        if (isExpandableRow) {
            // Replace [+] with ▼ initially
            const updatedContent = matchupCellContent.replace('[+]', '▼');
            row['Matchup'] = updatedContent;

            const matchupCell = newRow.querySelector('td:nth-child(2)'); // Assuming Matchup is the 2nd column
            if (matchupCell) {
                matchupCell.textContent = updatedContent;
            }

            // Rows with ▼: Add click functionality to toggle visibility
            newRow.classList.add('matchup-row');
            newRow.style.cursor = 'pointer';

            // Add click event listener to toggle visibility of subsequent rows
            newRow.addEventListener('click', function () {
                let nextRow = newRow.nextElementSibling;
                let isExpanded = false;

                while (nextRow && !nextRow.querySelector('td:first-child').textContent.trim()) {
                    // Toggle visibility of subsequent rows
                    nextRow.style.display =
                        nextRow.style.display === 'none' ? 'table-row' : 'none';

                    // If any row is set to 'table-row', consider it expanded
                    if (nextRow.style.display === 'table-row') {
                        isExpanded = true;
                    }

                    nextRow = nextRow.nextElementSibling;
                }

                // Toggle Matchup text between ▼ and ▲
                const currentContent = matchupCell.textContent;
                if (matchupCell) {
                    matchupCell.textContent = isExpanded
                        ? currentContent.replace('▼', '▲')
                        : currentContent.replace('▲', '▼');
                }
            });
        } else if (isHiddenRow) {
            // Hide rows with empty "Week" by default
            newRow.style.display = 'none';
        }

        tableBody.appendChild(newRow);
    });
}

        // Capture team selection and update the text
        document.getElementById('teamList').addEventListener('click', function (event) {
            event.preventDefault();
            if (event.target.tagName === 'A') {
                selectedTeam = event.target.getAttribute('data-value');
                document.getElementById('teamSelectText').textContent = selectedTeam;
            }
        });

        // Capture position selection and update the text
        document.getElementById('positionList').addEventListener('click', function (event) {
            event.preventDefault();
            if (event.target.tagName === 'A') {
                selectedPosition = event.target.getAttribute('data-value');
                document.getElementById('positionSelectText').textContent = selectedPosition;
                updateCheckboxes(); // Update checkboxes when the position changes
            }
        });

        // Fetch and populate data based on selected team and position
        document.getElementById('compareButton').addEventListener('click', function () {
            if (selectedTeam && selectedPosition) {
                const url = `https://www.cbssports.com/fantasy/football/stats/posvsdef/${selectedPosition}/${selectedTeam}/teambreakdown/standard`;

                const selectedColumns = updateTableHeaders();

                fetch(url)
                    .then((response) => response.text())
                    .then((data) => {
                        const parser = new DOMParser();
                        const doc = parser.parseFromString(data, 'text/html');

                        // Example: Use a simple selector to fetch rows
                        const rows = doc.querySelectorAll('.row1, .row2, .average-row');

                        // Convert fetched rows into structured data
                        const rowData = Array.from(rows).map((row) => {
                            const cells = row.querySelectorAll('td');
                            return selectedColumns.reduce((acc, colId, index) => {
                                acc[colId] = cells[index]
                                    ? cells[index].textContent.trim()
                                    : '';
                                return acc;
                            }, {});
                        });

                        // Update the table with the fetched data
                        updateTableRows(rowData, selectedColumns);
                    })
                    .catch((error) => {
                        console.error('Error fetching data:', error);
                        document.getElementById('statsTableBody').innerHTML =
                            '<tr><td colspan="12">Error fetching data. Please try again later.</td></tr>';
                    });
            } else {
                alert('Please select both a team and a position.');
            }
        });
      </script>
          </div>
        </div>
      <!-- /page content -->
  </body>
</html>